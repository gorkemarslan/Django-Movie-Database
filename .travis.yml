language: python

python:
  - "3.9"

before_install:
  - touch ./DjangoMovieDatabase/.env
  - echo DEBUG="$DEBUG" >> ./DjangoMovieDatabase/.env
  - echo SECRET_KEY="$SECRET_KEY" >> ./DjangoMovieDatabase/.env
  - echo OMDB_API_KEY="$OMDB_API_KEY" >> ./DjangoMovieDatabase/.env
  - echo POSTGRES_HOST="$POSTGRES_HOST" >> ./DjangoMovieDatabase/.env
  - echo POSTGRES_DB="$POSTGRES_DB" >> ./DjangoMovieDatabase/.env
  - echo POSTGRES_USER="$POSTGRES_USER" >> ./DjangoMovieDatabase/.env
  - echo POSTGRES_PASSWORD="$POSTGRES_PASSWORD" >> ./DjangoMovieDatabase/.env
  - echo ALLOWED_HOSTS="$ALLOWED_HOSTS" >> ./DjangoMovieDatabase/.env
  - cat ./DjangoMovieDatabase/.env

services:
  - postgresql

before_script:
  - psql -c 'create database "$POSTGRES_DB";' -U postgres

script:
  - python manage.py migrate
  - python manage.py makemigrations
  - python manage.py test && flake8